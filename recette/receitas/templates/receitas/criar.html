{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
    input:not([type="file"]),
    textarea,
    select,
    .ingrediente-input {
        border-color: #d1d5db !important;
        transition: border-color 0.2s;
    }

    input:not([type="file"]):focus,
    textarea:focus,
    select:focus,
    .ingrediente-input:focus {
        border-color: #D68E6E !important;
        box-shadow: 0 0 0 2px #f3e0d8;
    }

    input[type="checkbox"].form-checkbox {
        accent-color: #D68E6E;
        border-width: 2px;
        border-radius: 0.375rem;
        width: 1.25rem;
        height: 1.25rem;
        min-width: 1.25rem;
        min-height: 1.25rem;
        background: #FEFBFB;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    input[type="checkbox"].form-checkbox:focus {
        outline: none;
        box-shadow: 0 0 0 2px #f3e0d8;
        border-color: #D68E6E;
    }
</style>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>





<main class="max-w-2xl mx-auto bg-[#FAF8F6] rounded-lg shadow-md p-6 mt-12 mb-12">
    <h1 class="text-2xl font-bold text-[#242424] mb-6">Criar nova receita</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Título -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mb-2" for="id_titulo">Título:</label>
            {{ form.titulo }}
            {% if form.titulo.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.titulo.errors.as_text }}</p>
            {% endif %}
        </div>

        <!-- Imagem -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mb-2">Imagem da Receita:</label>
            <div class="flex items-center justify-center w-full">
                <label
                    class="flex flex-col items-center justify-center w-full h-32 border-2 border-[#D68E6E] border-dashed rounded-lg cursor-pointer bg-[#FEFBFB] hover:bg-[#F3ECEC]">
                    <div class="flex flex-col items-center justify-center pt-5 pb-6">
                        <img id="preview-img" class="w-20 h-20 object-cover mb-4 hidden rounded" />
                        <svg id="upload-svg" class="w-8 h-8 mb-4 text-[#D68E6E]" aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2" />
                        </svg>
                        <p id="upload-text" class="mb-2 text-sm text-[#D68E6E]">Clique para adicionar foto</p>
                    </div>
                    {{ form.imagem }}
                </label>
            </div>
        </div>

        <!-- Descrição -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mb-2" for="id_descricao">Descrição:</label>
            {{ form.descricao }}
            {% if form.descricao.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.descricao.errors.as_text }}</p>
            {% endif %}
        </div>

        <!-- Selecionar Ingredientes -->
        <div class="mb-6"> <label class="block text-[#242424] font-medium mb-2">Selecionar Ingredientes:</label>

<select id="id_ingredientes" name="ingredientes" multiple="multiple" class="select2 w-full">
    {% for ingrediente in form.fields.ingredientes.queryset %}
        <option value="{{ ingrediente.pk }}">
            {{ ingrediente.nome }}
        </option>
    {% endfor %}
</select>
            <p class="text-sm text-gray-500 mt-2">Segure <strong>Ctrl</strong> (ou <strong>Cmd</strong> no Mac) para
                selecionar mais de um ingrediente.</p>
        </div>
        <div class="mb-6 flex justify-end"></div> <a href="{% url 'criar_ingrediente' %}"
            class="inline-flex items-center px-4 py-2 bg-[#D68E6E] text-white rounded hover:bg-[#cd8061] transition font-semibold">
            <i class="fa fa-plus mr-2"></i> Adicionar novo ingrediente </a> </div>

        <!-- Instruções -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mt-3 mb-2">Instruções:</label>
            {{ form.instrucoes }}
            {% if form.instrucoes.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.instrucoes.errors.as_text }}</p>
            {% endif %}
        </div>

        <!-- Equipamentos -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mb-2">Equipamentos necessários:</label>
            {{ form.equipamentos }}
            {% if form.equipamentos.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.equipamentos.errors.as_text }}</p>
            {% endif %}
        </div>

        <!-- Porções -->
        <div class="mb-6">
            <label class="block text-[#242424] font-medium mb-2" for="id_porcoes">Porções:</label>
            {{ form.porcoes }}
            {% if form.porcoes.errors %}
            <p class="text-red-500 text-sm mt-1">{{ form.porcoes.errors.as_text }}</p>
            {% endif %}
        </div>
        <button type="submit"
            class="w-full py-2 px-4 bg-[#D68E6E] text-white rounded-lg shadow hover:bg-[#cd8061] transition font-semibold">Salvar
            Receita</button>
    </form>
</main>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        
        const stylize = el => el.classList.add(
            'w-full', 'px-4', 'py-2', 'border', 'rounded-md',
            'focus:outline-none', 'focus:ring-2', 'focus:ring-[#D68E6E]',
            'bg-[#FEFBFB]', 'text-[#242424]'
        );
        document.querySelectorAll('input:not([type="file"]):not(.ingrediente-input), textarea, select').forEach(stylize);
        document.querySelectorAll('.ingrediente-input').forEach(stylize);
        document.querySelectorAll('select').forEach(s => s.classList.add('appearance-none'));

        
        const imagemInput = document.querySelector('input[type="file"]');
        if (imagemInput) {
            imagemInput.addEventListener('change', function () {
                const fileNameSpan = document.getElementById('file-name');
                fileNameSpan.textContent = imagemInput.files.length > 0 ? imagemInput.files[0].name : '';
            });
        }

        
        const ingredientesList = document.getElementById('ingredientes-list');
        const addIngredienteBtn = document.getElementById('add-ingrediente');
        addIngredienteBtn.addEventListener('click', function () {
            const newItem = document.createElement('div');
            newItem.className = 'flex mb-2 gap-2 ingrediente-item';
            newItem.innerHTML = `
                <input type="text" name="ingredientes[]" placeholder="Ingrediente" class="ingrediente-input" />
                <button type="button" class="remove-ingrediente px-3 py-2 bg-red-400 text-white rounded hover:bg-red-500 transition">
                    <i class="fa fa-minus"></i>
                </button>
            `;
            ingredientesList.appendChild(newItem);
            stylize(newItem.querySelector('.ingrediente-input'));
            updateRemoveButtons();
        });
        ingredientesList.addEventListener('click', function (e) {
            if (e.target.closest('.remove-ingrediente')) {
                e.preventDefault();
                const item = e.target.closest('.ingrediente-item');
                if (item) {
                    item.remove();
                    updateRemoveButtons();
                }
            }
        });
        function updateRemoveButtons() {
            const items = ingredientesList.querySelectorAll('.ingrediente-item');
            items.forEach((item, idx) => {
                const btn = item.querySelector('.remove-ingrediente');
                if (btn) btn.style.display = items.length > 1 ? '' : 'none';
            });
        }
        updateRemoveButtons();

    });

    document.addEventListener('DOMContentLoaded', function () {
        const imagemInput = document.querySelector('input[type="file"]');
        const previewImg = document.getElementById('preview-img');
        const uploadSvg = document.getElementById('upload-svg');
        const uploadText = document.getElementById('upload-text');

        imagemInput.addEventListener('change', function () {
            const file = imagemInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImg.src = e.target.result;
                    previewImg.classList.remove('hidden');
                    uploadSvg.classList.add('hidden');
                    uploadText.textContent = file.name;
                }
                reader.readAsDataURL(file);
            }
        });
    });



    document.addEventListener('DOMContentLoaded', function() {
  $('select[name="ingredientes"]').select2({
    placeholder: "Pesquise e selecione ingredientes",
    allowClear: true,
    width: '100%'
  });
});

</script>
{% endblock %}